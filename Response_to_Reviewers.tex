%% start of file `template.tex'.
%% Copyright 2006-2013 Xavier Danaux (xdanaux@gmail.com).
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License version 1.3c,
% available at http://www.latex-project.org/lppl/.


\documentclass[11pt,a4paper,sans]{moderncv}        % possible options include font size ('10pt', '11pt' and '12pt'), paper size ('a4paper', 'letterpaper', 'a5paper', 'legalpaper', 'executivepaper' and 'landscape') and font family ('sans' and 'roman')

\usepackage[document]{ragged2e}
% pour justifier


% moderncv themes
\moderncvstyle{banking}                            % style options are 'casual' (default), 'classic', 'oldstyle' and 'banking'
\moderncvcolor{red}                                % color options 'blue' (default), 'orange', 'green', 'red', 'purple', 'grey' and 'black'
\renewcommand{\familydefault}{\rmdefault} 
%\nopagenumbers{} 
\usepackage[utf8]{inputenc} 
\usepackage[scale=0.9]{geometry}


\def \draft {1}
\usepackage{xparse}
\usepackage{ifthen}
\DeclareDocumentCommand{\comment}{o m o o o o}
{\ifthenelse{\draft=1}{
  \IfValueT{#1}{
      \textcolor{red}{\textbf{C (#1) : }#2}
      \IfValueT{#3}{\textcolor{blue}{\textbf{A1 : }#3}}
      \IfValueT{#4}{\textcolor{ForestGreen}{\textbf{A2 : }#4}}
      \IfValueT{#5}{\textcolor{red!50!blue}{\textbf{A3 : }#5}}
      \IfValueT{#6}{\textcolor{Aquamarine}{\textbf{A4 : }#6}}
    }
    \IfNoValueT{#1}{
      \textcolor{red}{\textbf{C : }#2}
      \IfValueT{#3}{\textcolor{blue}{\textbf{A1 : }#3}}
      \IfValueT{#4}{\textcolor{ForestGreen}{\textbf{A2 : }#4}}
      \IfValueT{#5}{\textcolor{red!50!blue}{\textbf{A3 : }#5}}
      \IfValueT{#6}{\textcolor{Aquamarine}{\textbf{A4 : }#6}}
    }
 }{}
}


\firstname{}
\lastname{}
\begin{document}

% recipient data
\recipient{Editor CEUS}{}
\date{\today}
\opening{Dear Editor,}
\closing{Yours faithfully,\\
Juste Raimbault and co-authors%\\
%Université Paris 7 - UMR CNRS 8504 Géographie-cités
}
         % use an optional argument to use a string other than "Enclosure", or redefine \enclname

%\makelettertitle


%Dear Editor,

\justify


Thank you for the feedback on the draft paper ``Space Matters: extending sensitivity analysis to initial spatial conditions in geosimulation models''. The suggestions and comments will undoubtedly be of great value to the paper. It was updated accordingly.

\medskip

% Thank you for submitting your manuscript to Computers, Environment and Urban Systems. I have completed the review of your manuscript and a summary is appended below. The reviewers recommend reconsideration of your paper following major revision. I invite you to resubmit your manuscript after addressing all reviewer comments.

% When revising your paper, pay special attention to the explicit presentation of every model that is investigated in the paper. Present each model as an algorithm/unambiguous pseudocode and supply the Netlogo code for downloading (all this can be in appendix). The Schelling model, for example, has several Netlogo implementation, and it is critically important to know which of them is investigated. The same is true for the Sugarscape model. See comments of the reviewer #1 in this respect.

% When resubmitting your manuscript, please carefully consider all issues mentioned in the reviewers' comments, outline every change made point by point, and provide suitable rebuttals for any comments not addressed.




First, the following general changes were done:

\begin{itemize}
	\item Several comments, including the ones of the first and third referee, were linked to clarity and explicit description of models: we clarified the descriptions and better justified our choices, and also provided pseudo-codes in Appendix and made clearer that source code are openly available.
    \item The feedback on the third referee that the most interesting was the phase diagram comparison was not directly compatible with other referees comments; we however added some developments and comments on this point to conciliate as most as possible these different comments.
\end{itemize}

\medskip



We provide now you point-by-point responses to referees comments.


\medskip


Concerning specifically the comments made by the first referee:

\begin{itemize}
	% 1. I think it would be better if the author would focus on a single model. This way they could describe the model and the analyses in more detail. As it stands, the models are treated as black boxes. 
	\item The suggestion to focus on a single model is indeed a qualified comment. However, after presenting our research to several audiences, we came to the conclusion that the genericity of our approach would be better served by two case studies than with a single model. In that perspective, the ``black-box'' is seen as an advantage as it suggests this genericity. We acknowledge the fact that this choice led us to shorten their presentations. Nevertheless, we have been taking heed to your remark to improve the description of the models by adding pseudo-codes in Appendix and recalling more clearly the link to model source we used.
    %We believe this is sufficient as the models have not been adjusted from these textbook cases implementations.
   
   % I believe it would be better to begin with an illustrative example on how two or three initial patterns influence the model results and then use the suggested method for a more extensive analysis
   \item \comment[JR]{Possibility to find configuration with an ``eyeball'' difference ? i'm not sure of that..}
	
	% 2. It is very important to describe the models. This is especially relevant for the Schelling model, which has many variants; each has different dependencies on the initial pattern. In my opinion, the NetLogo implementation is not the best choice because the model does not reach a state of segregation when agents are highly intolerant.
	%\comment[MLT]{Thank you for this comment. The reason why we have decided to use the NetLogo implementations was again to help the readers to distance themselves from the case studies and focus on the genericity of the approach. This also explains why we have chosen Sugarscape as a second example: these two models are often used as toy models due to the simplicity of their mechanisms (in the NetLogo scenarios) and therefore do not require a high level of expertise nor technicality to apprehend the impacts of the initial spatial conditions on the model outputs. This is again an argument in favour of our choice: space-dependent variations are to be expected even with the most simple sociospatial models.}
    \item There was a misunderstanding for the Schelling implementation actually used, as we used our own implementation which pseudo-code has been added in Appendix of the paper and source code is openly available on the git repository of the project. This version implements the one used by (Gauvin et al., 2009), which also influenced us for the use of the term ``phase diagram''. It does not either reach a segregated state for high values of intolerance, but it does not cause a problem in our case as indicators can be computed on any model state (and actually reflect the fact that it is not segregated).
    \item More generally concerning the choice of these two models, we aim at helping the readers to distance themselves from the case studies and focus on the genericity of the approach. This also explains why we have chosen Sugarscape as a second example: these two models are often used as toy models due to the simplicity of their mechanisms and therefore do not require a high level of expertise nor technicality to apprehend the impacts of the initial spatial conditions on the model outputs. This is again an argument in favour of our choice: space-dependent variations are to be expected even with the most simple sociospatial models.
	
	% 3. I am not sure why the Sugarscape model has been chosen given that the paper seems to be focused on cities.
	\item Furthermore concerning the choice of the Sugarscape model, we think it is a good example of a stylized model of a spatialized socio-economic system, and according to (Batty, 2005) a good metaphor of an urban system. Our choice was accordingly clarified in the paper.
%: "In an urban environment, Sugarscape can be used to model how the spatial distribution of any type of goods or services can influence the spread of wealth among inhabitants." % pas besoin de mettre les modifs ici
	
	% 4. Consider replacing “meta parameters” with something like “generator parameters” or “initial pattern parameters.”
	%In order to clarify the concept of ``meta-parameter'' that we prefer to keep, we now propose a short definition after the first use of the term (section Methods): "In addition to the usual protocol (upper branch of the figure), which consists of running a model $\mu$ with different values of its parameters, we introduce a spatial generator which depends on its very own set of parameters and feeds the model $\mu$ at initialisation (lower branch). We call these parameters meta-parameters to distinguish from the standard parameters of the models and highlight their higher position in the simulation process".
    \item \comment[JR]{TB la def Marion ; là on peut choisir de virer en effet le terme, ou dire que les 3 sont interchangeable mais que "meta-" est plus pratique, qu'en pensez vous ?}
	
	% 5. Line 228: Please explain why the median was chosen. Especially given that you use an L2 norm and variances in the index
	\item \comment[JR]{je pensais qu'on prenait la moyenne ? je verifie...}
	
	% 6. Line 232: comparing phase diagrams is related to the topic of comparing patterns. It would make sense to mention the methods that are usually used to compare patterns
	\item \comment[JR]{biblio a rajouter}
	
	% 7. Line 238: Please explain why this particular index was chosen and discuss its properties. Connect the discussion to other indices like L1, and Linf norms, etc. Would we get qualitatively different results from different indices? 
	\item \comment[JR]{on avait teste avec le Monge ca donnait a peut pres pareil ; donc les normes alpha surement encore plus. je regarde.}
	
	% 8. Regarding the spatial generator: the authors should explain why this generator is relevant to these two models? 
	\item This spatial generator is relevant to both model as it produces density grids at a ``metropolitan scale'' (see detailed discussion added in Appendix and the original paper from which we used the generator), which is the scale at which both model were initially intended to be. We made this aspect more explicit.
	
	% 9. The authors should illustrate the contribution of each parameter of the generator to the generated initial pattern using a figure. Details of the generators should be included in an appendix
	\item The behavior of the spatial generator was described with more details in Appendix.
	
	% 10. Explain how the density grids are used in the Schelling model, do you allow more than one agent to be in the same cell? 
	\item \comment[JR]{il a mal lu ou on est pas assez explicites, a detailler}
	
	% 11. Line 297: I am not sure why empirical density destitutions of cities are important in the context of this study. 
	\item 
	
	% 12. Line 641: NetLogo supports grids, continuous space, and GIS elements. It does not restrict the user in any way.
	\item \comment[JR]{plutot d'accord avec lui mais parce que proficient en NetLogo, peut etre que des debutants sont plus contraints ? quelquun aurait une ref là dessus ?}
	
	% 13. Line 301: I am not sure what the authors mean by “interesting grids”
	\item The term ``interesting grids'' was a typo and corrected, ``grids'' only was meant.
	
	% 14. Line 671: The same comment regarding “mythical ABMs” 
	\item The term ``mythical'' line 671 was a language mistake and corrected, ``well-known'' ABM was meant.
\end{itemize}




Concerning the comments made by the second referee:

%This is an interesting article that I read with true interest. The paper fits the profile of this journal and can reach a wider audience.

%I also have some concerns:

\begin{itemize}
	% In the abstract the authors claim that initial spatial conditions are often taken for granted. I do not agree to this statement. Initial spatial condition can have a large impact on the results of a model, however I do not think that the initial spatial conditions are often taken for granted.
	\item \comment[JR]{il s'agirait de nuancer ici}
	
	% Page 2 line 88: the authors state that “Even in applied cases when GIS geometries of a particular city are used, the spatial distribution of agents is still approximated by a constant density”, I do not think this is true. Many models generate a heterogeneous synthetic population that is based on local data (replicating the actual population as closely as possible) and in far more detail then what is done in this paper. I am thinking of work in the line of disease diffusion, crime etc.
	\item \comment[JR]{il a un point car ce sont des classes de modeles qu'on a pas trop cité ? par contre la sensibilite a ces distribs precises n'est pas testée, ou pas systeématiquement : il faut qu'on clarifie ou reformule}
	
	% Page 2 line 98: “However, this step is rarely explicit and authors tend to generalize the conclusion of the model from a single, spatial case study”. I do not understand the first part of the this statement. The steps taken are often very explicit. Due to the amount of time it takes to correctly represent all spatial data, including population densities and the variation of other population variables over space, many authors indeed restrict themselves to a single case study due to the time intensity of this task. Many agent-based models are also not valid for other areas.
	\item \comment[JR]{idem la on parle pas exactement du meme type de modeles, mais son exemple prouve notre propos : le modele tourne sur une situation unique, et on teste pas l'effet de l'espace.}
	
	% The authors do not differentiate between data driven empirical models versus theory-driven models. I think a clear differentiation between the two groups and the positioning of the two case studies in the second group would make the paper more balanced.
	\item \comment[JR]{oui du coup en disant ça ça repond à ses deux points précédents}
	
	% In section 1.3 (Previous considerations on the effects of the spatial configuration in simulation models) authors provide a lot of evidence on previous work on the impact of initial spatial conditions on the output of models. This is contrary to the statement in the abstract that initial conditions are often taken for granted.
	\item 
	
	% The most interesting part of the research to me, is not the way the density layers are generated but the use of the phase diagrams, defined as a vector of final aggregated model outputs. As these are vectors, they are not so different from time series and many techniques exist to compare vectors in this domain. I wonder if the Euclidean distance is the best measure to determine the difference between the phase vectors of different spatial inputs.
	% -> 
	\item
	
	% Last paragraph of page 5, you do not state explicitly if genetic algorithms were use within the OpenMOLE platform.
	\item The functionalities of OpenMOLE we used were detailed; we did not use genetic algorithms but sampling methods and high performance computing environments.
	
	% In section 3.1, page 8, line 404-405 the authors mention that the distance of the phase diagrams was measured with respect to the reference phase diagram computed on the default initial spatial conditions. Actually this came as a surprise to me. I had the impression that all phase diagrams would be evaluated against all other diagrams. Perhaps this should be explained earlier in the paper.
	\item 
	
	% Figure 4 and 5: I find it confusing that the green color indicates higher distance values and the red color indicates lower values. I think this should be reversed.
	\item \comment[JR]{Clem tu es d'accord là dessus ?}
	
	% I appreciate the fact that the authors in section 4 clearly indicate the limitations of their work (and I share the limitations listed under “comparing phase diagrams”). Personally I do not think that releasing the density grids is an important opportunity. As mentioned before I think that the core of the work is in the comparison of the phase vectors. I am not so sure the second opportunity listed in 4.2 is very valid. I do not think that the CEUS journal targets social sciences exactly.
	
	
\end{itemize}




Concerning the comments made by the third referee:


\begin{itemize}
	% I found the research question posed by the author(s) interesting and I agree with the author(s) that many modelers don’t consider how spatial arrangements impact the outcomes of the model and tend to focus only on the parameters. The paper makes good use of the complexity and spatial literature in defining the problem and demonstrates how urban form impacts the results. However, while the paper is innovative, I found it really difficult to interpret and follow the results. I would suggest to the author to rewrite the results and methodology so that they flow better and also provide more context with respect to how to interpret the results.
	\item 
	
	% On a side note, one of your key words you use “validation” but in what sense?  You don’t really come back to this in the paper, also you write about “the validity of generative models is uncertain until their results are proven robust and representative of ’real-world’ conditions.” In the abstract but this is it.  What do you consider real world conditions to be? You seem to allude that you need to have the spatial generator to generate realistic (styles) city shapes for testing on the Schelling model but I am not convinced.  After the abstract all notion of validation is missing.
	\item 
	
	% Geosimulation is introduced but not defined or referenced.  This should be clarified as the term has several meanings etc.
	\item 
	
	% In places the English along with the overall argument could be better articulated. For example, on page 1 you write: “We think simulation can become a very good tool to achieve this,”  Could this be rewritten or better argued. You are not the only one to believe this but you don’t show this in your paper.
	\item 
	
	% Page 4: you write “Generally, sensitivity analyses have focused either on the spatial context (extent of the environment, shape of the zones if applicable - squares, hexagons, etc., objects - links, rasters, etc.); either on the spatial encoding of the heterogeneity of space (algorithms of disaggregation, interpolation, etc.), but rarely on both at the same time” This makes little sense. What it should be is “Generally, sensitivity analyses have focused either on the spatial context or the heterogeneity of space” or something like that. Basically you need the “or”.
	\item 

	% You write “To our knowledge there exist no single well established method to compare phase diagrams in the agent-based modelling and geosimulation literature.” As this is new you may want to discuss how say its done in other fields?  
	\item \comment[JR]{cf remarques other reviewers sur ce point}
	
	% In the Schelling and sugarscape models how are the initial population of agents distributed? Is it random? I ask as this is unclear in the current version of the paper but it is vital if your purpose is to explore how the initial spatial configuration impacts the results of the model. Should the agents not be all located at the same location for each run to rule out the impact of initial placement of agents on the resulting patterns? This is something that is not addressed in the paper. I know for example, the Schelling model in NetLogo normally places the agents at random locations but in your reimplementation how is this done? The same goes for the sugarscape model in NetLogo. I believe a clearer description of the model initialization would be good and how its not the initial random placement of agents but the actual environment that impacts the outcomes. Maybe this was explained in the paper but I missed it.  
	\item \comment[JR]{on regarde des indicateurs aggreges qui ne dependent pas de la trajectoire de chaque agent, si le placement initial est random il na aucune influence sur ceux-ci (cf les distribs) -> ajouter des graphes de comportement stat des modeles en Appendix ?}
	
	% In Section 1.2 talk about “(monocentric vs. polycentric for example)” but in the results you don’t discuss the monocentric versions explicitly using these terms.
	\item 
	
	% Also I appreciate you are trying to show rather complex results but reading the results several times I found the presentation of them (both written and visual) really hard to follow and understand. I was wondering if maybe you could find a better way to show / discuss them. Maybe a  worked example of how each set of parameters leads to a point in say Figure 4. Also it is confusing why the results from both models are not presented using the same styles of figures. For example, for the sugar scape model you different styles of figures than for the segregation model.   
	\item 
\end{itemize}



 
Concerning the comments made by the fourth referee:


\begin{itemize}
	% In sensitivity analysis of spatial models, stochastic effects and small parameter changes are normally applied. What about initial conditions? The authors test the effects of different arrangements (e.g. monocentric vs. polycentric density patterns) on agent-based Schelling segregation models and Sugarscape's unequal societies model.
	\item 
	
	% Overall, I find this to be a very good paper. Very well written in general. Good review of the problem, clearly outlining (with references) the need for focus on initial conditions in geosimulation. The chief factors (data uncertainty, nature of spatial units (e.g. shape) and spatial heterogeneity) on initial spatial conditions are covered: -how many of these do you test? I see heterogeneity addressed, but what about shape and uncertainty? You touch upon shape when talking about NetLogo's use of raster as opposed to vector in the Discussion - could you expand on this?
	\item 
	
	% Rigorous experimental method described. In the matching of European metropolitan areas to your generated outputs, I wonder what you are missing by not using cities from other continents. i.e. by widening the cities available to your study it may be possible to even better discover real-world examples of your archtypes (compact, polycentric, discontinuous).
	\item 
	
	% Why do you not have the same amount of repetitions for your Sugarscape (50 repetitions) and Schelling (100 repetitions) model runs?
	\item \comment[JR]{no justification $\rightarrow$ new runs ?}
	
	% You say your models are open source - do you give details of that source?  
	\item 
	
	% Small edits:
	% X line 68: "...a different system"
	% figure 1: modify font size so that labels do not go to the edge of their respective objects
	% TODO Clem
	% figure 2: can you add the parameters that led to each of the grids
	% TODO Juste
	% figure 3: check spelling of "Augburg" (should be Augsburg)
	% TODO Clem
	% line 350: "...consists of..."
	% X line 455: "sa,e" = "same"? OK
	%figure 4 and figure 5 captions: make it explicit that we're seeing the Sugarscape results here.
	%line 515: "analyse" = "analysis"
	%line 593: "at reach" = "within reach"
	%line 671: would "classic" or "hypothetical" be better words (choice dependent on your meaning) than "mythical", which implies these are models of centuries ago and somehow out of reach..
	\item Spelling errors and approximations in the vocabulary chosen were corrected.
\end{itemize}







\justify




\makeletterclosing





\end{document}


%% end of file `template.tex'.